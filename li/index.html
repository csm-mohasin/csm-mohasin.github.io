<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSM | Neural Scrapper & History</title>
    <style>
        :root {
            --neon-cyan: #00f2ff;
            --neon-green: #39ff14;
            --bg-dark: #050505;
            --panel-bg: rgba(10, 10, 10, 0.9);
            --glow: 0 0 10px rgba(0, 242, 255, 0.5);
        }

        body, html {
            margin: 0; padding: 0;
            background: var(--bg-dark);
            color: #fff;
            font-family: 'Segoe UI', 'Courier New', monospace;
            overflow-x: hidden;
        }

        #matrix { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.15; }

        .main-wrapper {
            display: flex; flex-direction: column;
            align-items: center; min-height: 100vh;
            padding: 40px 20px; box-sizing: border-box;
        }

        .terminal-box {
            width: 100%; max-width: 1100px;
            background: var(--panel-bg);
            border: 1px solid var(--neon-cyan);
            border-radius: 15px;
            box-shadow: var(--glow);
            backdrop-filter: blur(8px);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .header {
            padding: 15px 25px;
            background: rgba(0, 242, 255, 0.1);
            border-bottom: 1px solid var(--neon-cyan);
            display: flex; justify-content: space-between; align-items: center;
        }

        .title { color: var(--neon-cyan); font-weight: bold; letter-spacing: 2px; }

        .body-content { padding: 25px; }

        .input-group {
            display: flex; gap: 10px; margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.03);
            padding: 15px; border-radius: 10px;
            border: 1px solid rgba(0, 242, 255, 0.2);
        }

        input { flex: 1; background: transparent; border: none; color: var(--neon-green); outline: none; font-size: 1rem; }

        button {
            background: transparent; border: 1px solid var(--neon-cyan);
            color: var(--neon-cyan); padding: 8px 20px;
            cursor: pointer; border-radius: 5px; transition: 0.3s;
        }

        button:hover { background: var(--neon-cyan); color: #000; box-shadow: 0 0 15px var(--neon-cyan); }

        .tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab-btn { padding: 5px 15px; font-size: 0.8rem; border: 1px solid rgba(0, 242, 255, 0.3); color: #888; border-radius: 3px; cursor: pointer; }
        .tab-btn.active { color: var(--neon-cyan); border-color: var(--neon-cyan); background: rgba(0, 242, 255, 0.1); }

        #console {
            height: 120px; overflow-y: auto;
            background: rgba(0, 0, 0, 0.4);
            padding: 10px; border-radius: 5px;
            font-size: 0.85rem; border-left: 3px solid var(--neon-cyan);
            margin-bottom: 20px; scroll-behavior: smooth;
        }

        .table-container { max-height: 450px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { background: rgba(0, 242, 255, 0.1); color: var(--neon-cyan); padding: 12px; text-align: left; position: sticky; top: 0; z-index: 10; }
        td { padding: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
        
        /* Row Animation */
        .row-animate {
            animation: fadeIn 0.5s ease forwards;
            opacity: 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        a { color: var(--neon-green); text-decoration: none; }
        a:hover { text-decoration: underline; }

        .footer { text-align: center; padding: 20px; width: 100%; border-top: 1px dashed rgba(0, 242, 255, 0.2); }
        .dev-name { color: var(--neon-cyan); text-decoration: none; font-weight: bold; letter-spacing: 2px; }

        .delete-btn { color: #ff3e3e; cursor: pointer; float: right; font-weight: bold; }
    </style>
</head>
<body>

    <canvas id="matrix"></canvas>

    <div class="main-wrapper">
        <div class="terminal-box">
            <div class="header">
                <div class="title">CSM NEURAL SCANNER V4.0</div>
                <div id="clock">00:00:00</div>
            </div>

            <div class="body-content">
                <form id="scanForm">
                    <div class="input-group">
                        <input type="url" id="urlInp" placeholder="Enter target (e.g., https://mohasin.is-a.dev)" required>
                        <button type="submit" id="submitBtn">START_DECODING</button>
                    </div>
                </form>

                <div class="tabs">
                    <div class="tab-btn active" id="liveTab" onclick="switchView('live')">LIVE_DECODE</div>
                    <div class="tab-btn" id="histTab" onclick="switchView('history')">ARCHIVE_LOGS</div>
                </div>

                <div id="console">
                    <div style="color: #666;">[SYSTEM] Kernel loaded... Awaiting target acquisition.</div>
                </div>

                <div class="table-container" id="liveView">
                    <table>
                        <thead>
                            <tr><th>IDENTIFIER</th><th>MAPPED_TARGET</th></tr>
                        </thead>
                        <tbody id="resBody">
                            <tr><td colspan="2" style="text-align:center; color:#444;">No data in buffer</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="table-container" id="historyView" style="display:none;">
                    <table>
                        <thead>
                            <tr><th>DATETIME</th><th>DOMAIN_NODE</th><th>OBJECTS</th></tr>
                        </thead>
                        <tbody id="historyBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="footer">
            <div style="color: #888; font-size: 0.8rem;">Core Intelligence Developed By</div>
            <a href="#" class="dev-name">CSM MOHASIN ALAM</a>
        </div>
    </div>

    <script>
        const WORKER_URL = "https://late-dawn-6462.csmmohasinalam.workers.dev/";
        let scanHistory = JSON.parse(localStorage.getItem('csm_history')) || [];

        // Helper: Log with typing effect
        async function log(text, type = 'info') {
            const colors = { info: '#00f2ff', success: '#39ff14', error: '#ff3e3e' };
            const div = document.createElement('div');
            div.style.color = colors[type];
            div.style.marginBottom = "5px";
            div.innerHTML = `[${new Date().toLocaleTimeString()}] `;
            document.getElementById('console').appendChild(div);
            
            const messageSpan = document.createElement('span');
            div.appendChild(messageSpan);

            for (let i = 0; i < text.length; i++) {
                messageSpan.textContent += text.charAt(i);
                await new Promise(r => setTimeout(r, 10)); // Typing speed for console
            }
            document.getElementById('console').scrollTop = document.getElementById('console').scrollHeight;
        }

        async function renderLinksAnimated(links, baseUrl) {
            const body = document.getElementById('resBody');
            body.innerHTML = '';
            
            for (let i = 0; i < links.length; i++) {
                const item = links[i];
                let absolute = item.link;
                try { absolute = new URL(item.link, baseUrl).href; } catch(e) {}
                
                const tr = document.createElement('tr');
                tr.className = 'row-animate';
                tr.innerHTML = `
                    <td>${item.anchorText || '[HIDDEN_NODE]'}</td>
                    <td><a href="${absolute}" target="_blank">${absolute}</a></td>
                `;
                body.appendChild(tr);
                
                // Delay between each row to create "typing/streaming" effect
                await new Promise(r => setTimeout(r, 40)); 
            }
        }

        function saveToHistory(url, count) {
            const entry = { id: Date.now(), time: new Date().toLocaleString(), url: url, count: count };
            scanHistory.unshift(entry);
            if(scanHistory.length > 15) scanHistory.pop();
            localStorage.setItem('csm_history', JSON.stringify(scanHistory));
            renderHistory();
        }

        function renderHistory() {
            const body = document.getElementById('historyBody');
            body.innerHTML = scanHistory.map(item => `
                <tr class="row-animate">
                    <td>${item.time}</td>
                    <td>${item.url}</td>
                    <td>${item.count} <span class="delete-btn" onclick="deleteHistory(${item.id})">âœ–</span></td>
                </tr>
            `).join('');
        }

        function deleteHistory(id) {
            scanHistory = scanHistory.filter(i => i.id !== id);
            localStorage.setItem('csm_history', JSON.stringify(scanHistory));
            renderHistory();
        }

        function switchView(view) {
            document.getElementById('liveTab').classList.toggle('active', view === 'live');
            document.getElementById('histTab').classList.toggle('active', view === 'history');
            document.getElementById('liveView').style.display = view === 'live' ? 'block' : 'none';
            document.getElementById('historyView').style.display = view === 'history' ? 'block' : 'none';
        }

        document.getElementById('scanForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const url = document.getElementById('urlInp').value;
            const btn = document.getElementById('submitBtn');
            
            btn.disabled = true;
            switchView('live');
            document.getElementById('resBody').innerHTML = '<tr><td colspan="2" style="text-align:center;">ACQUIRING DATA...</td></tr>';
            
            await log(`Establishing link to neural node: ${url}...`);
            
            try {
                const res = await fetch(`${WORKER_URL}?target=${encodeURIComponent(url)}`);
                const data = await res.json();
                if (!res.ok) throw new Error(data.error);

                await log(`Injection successful. Found ${data.links.length} objects. Decoding strings...`, 'success');
                saveToHistory(url, data.links.length);
                await renderLinksAnimated(data.links, url);
                await log(`Display complete. Buffer flushed.`, 'info');

            } catch (err) {
                await log(`CRITICAL FAILURE: ${err.message}`, 'error');
            } finally {
                btn.disabled = false;
            }
        });

        // Matrix & Time Init
        renderHistory();
        setInterval(() => document.getElementById('clock').innerText = new Date().toLocaleTimeString(), 1000);
        
        const canvas = document.getElementById('matrix');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        const drops = Array(Math.floor(canvas.width/16)).fill(1);
        function draw() {
            ctx.fillStyle = "rgba(0,0,0,0.08)"; ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = "#00f2ff"; ctx.font = "15px monospace";
            drops.forEach((y, i) => {
                ctx.fillText(String.fromCharCode(Math.random()*128), i*16, y*16);
                if(y*16 > canvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            });
        }
        setInterval(draw, 50);
    </script>
</body>
</html>
