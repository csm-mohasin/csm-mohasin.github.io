<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Send Live Location - FAST</title>

<style>
body {
Â  font-family: Arial;
Â  background: #e9f3ff;
Â  display: flex;
Â  justify-content: center;
Â  align-items: center;
Â  height: 100vh;
}
.card {
Â  background: #fff;
Â  padding: 25px;
Â  width: 350px;
Â  border-radius: 12px;
Â  text-align: center;
Â  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}
.loading {
Â  font-size: 18px;
Â  font-weight: bold;
Â  color:#0a7b0a;
Â  margin-top: 15px;
}
#userIdDisplay {
Â  font-size: 18px;
Â  color: #007bff;
Â  margin-bottom: 10px;
}
</style>
</head>
<body>

<div class="card">
<h2>ğŸ“ Sharing Live Locationâ€¦</h2>

<p id="userIdDisplay">à¦‡à¦‰à¦œà¦¾à¦° à¦†à¦‡à¦¡à¦¿: **à¦œà§‡à¦¨à¦¾à¦°à§‡à¦Ÿ à¦¹à¦šà§à¦›à§‡...**</p>

<p class="loading" id="status">â³ Getting permission...</p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
// push à¦«à¦¾à¦‚à¦¶à¦¨ à¦¯à§‹à¦— à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡ à¦¦à§à¦°à§à¦¤ à¦‡à¦‰à¦¨à¦¿à¦• ID à¦¤à§ˆà¦°à¦¿à¦° à¦œà¦¨à§à¦¯
import { getDatabase, ref, update, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

// âœ… Your Firebase Config
const firebaseConfig = {
Â  apiKey: "AIzaSyCsGBSRCHVUhXQZ5DNMEZWgQWk1gxMF1E4",
Â  authDomain: "signup-d32c5.firebaseapp.com",
Â  databaseURL: "https://signup-d32c5-default-rtdb.firebaseio.com",
Â  projectId: "signup-d32c5",
Â  storageBucket: "signup-d32c5.firebasestorage.app",
Â  messagingSenderId: "583812949955",
Â  appId: "1:583812949955:web:fab1bb7be94bc1b4ab3f76",
Â  measurementId: "G-VLC3QHK8CG"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const statusText = document.getElementById("status");
const userIdDisplay = document.getElementById("userIdDisplay");

// ğŸ†• Global Variable for unique User ID (à¦²à§‹à¦•à¦¾à¦² à¦¸à§à¦Ÿà§‹à¦°à§‡à¦œ à¦¥à§‡à¦•à§‡ ID à¦¨à§‡à¦“à§Ÿà¦¾)
let **uniqueUserId** = localStorage.getItem('trackingId');

// ğŸ†• User ID à¦¤à§ˆà¦°à¦¿ à¦¬à¦¾ à¦¸à§‡à¦Ÿ à¦•à¦°à¦¾à¦° à¦«à¦¾à¦‚à¦¶à¦¨
function initializeUserId() {
    // à¦¯à¦¦à¦¿ à¦†à¦—à§‡ à¦•à§‹à¦¨à§‹ ID à¦¨à¦¾ à¦¥à¦¾à¦•à§‡, à¦¤à¦¬à§‡ à¦à¦•à¦Ÿà¦¿ à¦¨à¦¤à§à¦¨ ID à¦¤à§ˆà¦°à¦¿ à¦•à¦°à¦¾ à¦¹à¦¬à§‡
    if (!**uniqueUserId**) {
        // push().key à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à§‡ à¦¤à¦¾à§à¦•à§à¦·à¦£à¦¿à¦• à¦‡à¦‰à¦¨à¦¿à¦• à¦†à¦‡à¦¡à¦¿ à¦¤à§ˆà¦°à¦¿
        const newKey = push(ref(db, 'users')).key; 
        **uniqueUserId** = newKey;
        // à¦†à¦‡à¦¡à¦¿à¦Ÿà¦¿ à¦²à§‹à¦•à¦¾à¦² à¦¸à§à¦Ÿà§‹à¦°à§‡à¦œà§‡ à¦¸à§‡à¦­ à¦•à¦°à¦¾ (à¦¸à§à¦¥à¦¾à¦¯à¦¼à¦¿à¦¤à§à¦¬à§‡à¦° à¦œà¦¨à§à¦¯)
        localStorage.setItem('trackingId', newKey);
    }
    // à¦¡à¦¿à¦¸à¦ªà§à¦²à§‡ à¦†à¦ªà¦¡à§‡à¦Ÿ
    userIdDisplay.innerHTML = `à¦‡à¦‰à¦œà¦¾à¦° à¦†à¦‡à¦¡à¦¿: **${uniqueUserId}**`;
}


// âœ… Battery Check (à¦…à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¿à¦¤)
async function getBatteryLevel() {
Â try {
Â  Â const b = await navigator.getBattery();
Â  Â return Math.round(b.level * 100) + "%";
Â } catch {
Â  Â return "N/A";
Â }
}

// âœ… Network Type (à¦…à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¿à¦¤)
function getNetworkType() {
Â return navigator.connection?.effectiveType ?? "unknown";
}

// âœ… Save last location backup
function saveLast(lat, lon) {
Â // à¦¸à§à¦¬à¦¯à¦¼à¦‚à¦•à§à¦°à¦¿à¦¯à¦¼à¦­à¦¾à¦¬à§‡ à¦œà§‡à¦¨à¦¾à¦°à§‡à¦Ÿ à¦¹à¦“à§Ÿà¦¾ ID à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡
Â if (**uniqueUserId**) {
Â  Â update(ref(db, "users/" + **uniqueUserId**), {
Â  Â  Â last_lat: lat, 
Â  Â  Â last_lon: lon, 
Â  Â  Â last_time: new Date().toISOString()
Â  Â });
Â }
}

function sendLocation() {
Â // âœ… à¦²à§‹à¦•à§‡à¦¶à¦¨ à¦…à§à¦¯à¦¾à¦•à§à¦¸à§‡à¦¸ à¦ªà¦¾à¦“à§Ÿà¦¾à¦° à¦ªà¦° ID à¦‡à¦¨à¦¿à¦¶à¦¿à§Ÿà¦¾à¦²à¦¾à¦‡à¦œ à¦•à¦°à¦¾
Â initializeUserId();
Â 
Â navigator.geolocation.watchPosition(async pos => {
Â  Â const lat = pos.coords.latitude;
Â  Â const lon = pos.coords.longitude;
Â  Â const speed = pos.coords.speed ? (pos.coords.speed * 3.6).toFixed(1) : "0";
Â  Â 
Â  Â // à¦…à¦¤à¦¿à¦°à¦¿à¦•à§à¦¤ à¦¡à§‡à¦Ÿà¦¾ à¦¸à¦‚à¦—à§à¦°à¦¹
Â  Â const battery = await getBatteryLevel();
Â  Â const network = getNetworkType();
Â  Â const u = **uniqueUserId**;

Â  Â // Firebase-à¦ à¦¡à§‡à¦Ÿà¦¾ à¦†à¦ªà¦¡à§‡à¦Ÿ
Â  Â update(ref(db, "users/" + u), {
Â  Â  Â latitude: lat,
Â  Â  Â longitude: lon,
Â  Â  Â speed: speed,
Â  Â  Â battery: battery,
Â  Â  Â network: network,
Â  Â  Â time: new Date().toISOString()
Â  Â });

Â  Â saveLast(lat, lon);
Â  Â statusText.textContent = `âœ… Live: ${lat}, ${lon}`;
Â },Â 
Â err => statusText.textContent = "âŒ Permission Blocked!",Â 
Â { enableHighAccuracy: true });
}

// âœ… Auto request permission (à¦¤à¦¾à§à¦•à§à¦·à¦£à¦¿à¦•à¦¤à¦¾ à¦¨à¦¿à¦¶à§à¦šà¦¿à¦¤ à¦•à¦°à¦¤à§‡ à¦¸à¦¬à¦¾à¦° à¦†à¦—à§‡ à¦•à¦² à¦•à¦°à¦¾ à¦¹à¦²à§‹)
navigator.geolocation.getCurrentPosition(
Â ()=>{ statusText.textContent="âœ… Location access granted! Starting..."; sendLocation(); },
Â ()=>{ statusText.textContent="âŒ Enable location to continue!"; }
);

// âœ… Save final location when closing tab
window.addEventListener("beforeunload", () => {
Â  navigator.geolocation.getCurrentPosition(p => {
Â  Â  saveLast(p.coords.latitude, p.coords.longitude);
Â  });
});
</script>
</body>
</html>
