<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ğŸ“ Live Location Sharing</title>
<style>
body { font-family: Arial; text-align: center; padding-top:40px }
button {
  padding: 15px 25px; background:#007bff; color:#fff;
  border:none; border-radius:10px; font-size:18px;
}
</style>
</head>
<body>

<h2>ğŸ“ Live Location Sharing</h2>
<p>Status: <span id="status">Waiting...</span></p>
<button onclick="startTracking()">Start Live Tracking</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCsGBSRCHVUhXQZ5DNMEZWgQWk1gxMF1E4",
  authDomain: "signup-d32c5.firebaseapp.com",
  projectId: "signup-d32c5",
  storageBucket: "signup-d32c5.firebasestorage.app",
  messagingSenderId: "583812949955",
  appId: "1:583812949955:web:fab1bb7be94bc1b4ab3f76",
  measurementId: "G-VLC3QHK8CG",
  databaseURL: "https://signup-d32c5-default-rtdb.firebaseio.com/"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

async function getBatteryLevel() {
  try {
    if (!navigator.getBattery) return null;
    const b = await navigator.getBattery();
    return Math.round(b.level * 100);
  } catch { return null; }
}

function startTracking(){
  document.getElementById("status").innerHTML = "ğŸ“¡ Sending...";

  setInterval(async () => {
    navigator.geolocation.getCurrentPosition(async (pos) => {

      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;
      const battery = await getBatteryLevel() ?? "N/A";

      set(ref(db, "location"), {
        lat, lng, battery,
        device: navigator.userAgent,
        time: new Date().toString()
      });

      console.log("Location Sent âœ…", lat, lng);
      document.getElementById("status").innerHTML = "âœ… Live Sending";
    },
    (err)=>{
      console.log(err);
      document.getElementById("status").innerHTML = "âŒ Location Blocked!";
      alert("Please allow location permission!");
    });
  }, 5000);
}
</script>
</body>
</html>
