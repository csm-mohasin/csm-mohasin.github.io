<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Live Location Sender | ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #0a0a0a;
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #00ffd5;
      margin-bottom: 10px;
      font-weight: 700;
    }
    .status-container {
      background: #111;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 0 15px rgba(0, 255, 213, 0.4); /* Neon Glow */
      max-width: 350px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    .status-item {
        display: flex;
        justify-content: space-between;
        padding: 5px 0;
        border-bottom: 1px dashed #333;
    }
    .status-item:last-child {
        border-bottom: none;
    }
    .label {
        color: #00ffd5;
        font-weight: 600;
    }
    .value {
        color: #fff;
    }
    #permission-status {
        font-weight: 600;
        color: #f39c12; /* Warning color */
    }
    .error {
        color: #e74c3c !important;
    }
    .success {
        color: #2ecc71 !important;
    }
  </style>
</head>
<body>
  <h1>üõ∞Ô∏è ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞</h1>
  <p id="permission-status">‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
  
  <div class="status-container">
    <div class="status-item"><span class="label">Latitude:</span> <span class="value" id="lat">-</span></div>
    <div class="status-item"><span class="label">Longitude:</span> <span class="value" id="lon">-</span></div>
    <div class="status-item"><span class="label">Speed:</span> <span class="value" id="speed">-</span></div>
    <div class="status-item"><span class="label">Network:</span> <span class="value" id="net">-</span></div>
    <div class="status-item"><span class="label">Battery:</span> <span class="value" id="bat">-</span></div>
    <div class="status-item"><span class="label">Last Updated:</span> <span class="value" id="time">-</span></div>
  </div>

  <script type="module">
    // --- 1. DOM Element Caching ---
    const permissionStatusEl = document.getElementById("permission-status");
    const latEl = document.getElementById("lat");
    const lonEl = document.getElementById("lon");
    const speedEl = document.getElementById("speed");
    const netEl = document.getElementById("net");
    const batEl = document.getElementById("bat");
    const timeEl = document.getElementById("time");

    // --- 2. Firebase Setup (Replace with your actual configuration) ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // **ATTENTION:** Please replace these placeholder values with your OWN Firebase project's credentials.
    const YOUR_FIREBASE_CONFIG = {
      apiKey: "AIzaSyBQZaW4yRirnA40-NTa7TXT3CXVnBRvPRA", 
      authDomain: "live-tracker-setup.firebaseapp.com",
      databaseURL: "https://live-tracker-setup-default-rtdb.firebaseio.com",
      projectId: "live-tracker-setup",
      storageBucket: "live-tracker-setup.appspot.com",
      messagingSenderId: "278209268043",
      appId: "1:278209268043:web:73c8a8a5dc996f68c5b34e"
    };

    const app = initializeApp(YOUR_FIREBASE_CONFIG);
    const db = getDatabase(app);

    // Change this unique identifier for each user
    const USER_ID = "User-01-Device"; 

    // --- 3. Helper Functions ---
    
    /** Fetches the battery level. */
    async function getBatteryLevel() {
      try {
        if ('getBattery' in navigator) {
            const battery = await navigator.getBattery();
            return (battery.level * 100).toFixed(0) + "%";
        }
        return "N/A";
      } catch (e) {
        return "N/A";
      }
    }

    /** Determines the network type. */
    function getNetworkType() {
      try {
        const net = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
        return net ? net.effectiveType.toUpperCase() : "UNKNOWN";
      } catch (e) {
        return "UNKNOWN";
      }
    }

    /** Updates the UI with the latest data. */
    function updateUI(latitude, longitude, speed, battery, network, timestamp) {
        latEl.textContent = latitude.toFixed(6);
        lonEl.textContent = longitude.toFixed(6);
        speedEl.textContent = speed ? speed.toFixed(2) + " m/s" : "0.00 m/s";
        netEl.textContent = network;
        batEl.textContent = battery;
        timeEl.textContent = timestamp;
    }

    // --- 4. Main Location Handler ---

    /** Sends location data to Firebase and updates UI. */
    async function locationSuccess(position) {
      const { latitude, longitude, speed } = position.coords;
      const battery = await getBatteryLevel();
      const network = getNetworkType();
      const timestamp = new Date().toLocaleTimeString();

      // Update UI first
      updateUI(latitude, longitude, speed, battery, network, timestamp);
      
      // Then send to Firebase
      try {
        await set(ref(db, "users/" + USER_ID), {
          latitude,
          longitude,
          speed,
          battery,
          network,
          time: timestamp,
          accuracy: position.coords.accuracy.toFixed(2) + " m"
        });
        permissionStatusEl.textContent = `‚úÖ ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá (${timestamp})`;
        permissionStatusEl.classList.remove('error');
        permissionStatusEl.classList.add('success');
      } catch (e) {
        console.error("Firebase Send Error:", e);
        permissionStatusEl.textContent = "‚ö†Ô∏è Firebase-‡¶è ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§ (‡¶ï‡¶®‡¶∏‡ßã‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®)";
        permissionStatusEl.classList.add('error');
      }
    }

    /** Handles Geolocation API errors. */
    function locationError(error) {
      console.error("Geolocation Error:", error);
      let errorMessage = "‚ùå ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶Ö‡¶∏‡ßç‡¶¨‡ßÄ‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‡¶¨‡¶æ ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§";
      if (error.code === error.PERMISSION_DENIED) {
          errorMessage = "‚ùå ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§";
      } else if (error.code === error.POSITION_UNAVAILABLE) {
          errorMessage = "‚ùå ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ‡•§";
      } else if (error.code === error.TIMEOUT) {
          errorMessage = "‚ùå ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶∂‡ßá‡¶∑ (Timeout)‡•§";
      }
      permissionStatusEl.textContent = errorMessage;
      permissionStatusEl.classList.remove('success');
      permissionStatusEl.classList.add('error');
    }

    // --- 5. Initialization ---
    window.onload = () => {
      if ("geolocation" in navigator) {
        permissionStatusEl.textContent = "‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
        
        // Request an initial position to check permission
        navigator.geolocation.getCurrentPosition(
          () => {
            permissionStatusEl.textContent = "‚úÖ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
            
            // Start watching position continuously
            navigator.geolocation.watchPosition(locationSuccess, locationError, {
              enableHighAccuracy: true,
              maximumAge: 0, 
              timeout: 15000 // Increased timeout for better stability
            });
          },
          locationError, // Handles the permission denial directly
          { enableHighAccuracy: true }
        );
      } else {
        permissionStatusEl.textContent = "‚ùå ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá Geolocation ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡•§";
        permissionStatusEl.classList.add('error');
      }
    };
  </script>
</body>
</html>
