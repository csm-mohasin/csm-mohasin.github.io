<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSM Ultra Radar | Mohasin Alam</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <style>
        :root {
            --neon-blue: #00f3ff;
            --radar-bg: rgba(10, 20, 30, 0.85);
        }

        body, html { margin: 0; padding: 0; height: 100%; background: #050505; color: var(--neon-blue); font-family: 'Share Tech Mono', monospace; }
        
        #map { height: 100vh; width: 100%; z-index: 1; background: #050505; }

        /* Smart UI Panel */
        .glass-panel {
            position: absolute;
            top: 20px; left: 20px; z-index: 1000;
            background: var(--radar-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 243, 255, 0.3);
            padding: 20px; border-radius: 8px;
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.1);
            width: 280px;
        }

        h1 { font-family: 'Syncopate', sans-serif; font-size: 14px; margin: 0 0 15px 0; letter-spacing: 3px; color: #fff; border-left: 3px solid var(--neon-blue); padding-left: 10px; }

        .stat-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; }
        .label { color: rgba(255,255,255,0.6); }
        .value { color: var(--neon-blue); text-shadow: 0 0 8px var(--neon-blue); }

        .dev-info { margin-top: 20px; font-size: 10px; border-top: 1px dashed rgba(255,255,255,0.2); padding-top: 10px; text-align: center; }
        .dev-name { color: #facc15; font-weight: bold; text-transform: uppercase; }

        /* Radar Scanning Animation */
        .radar-scan {
            position: absolute;
            top: 50%; left: 50%;
            width: 400px; height: 400px;
            background: conic-gradient(from 0deg, rgba(0, 243, 255, 0.1) 0%, transparent 40%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: rotateRadar 4s linear infinite;
            pointer-events: none;
            z-index: 500;
        }

        @keyframes rotateRadar {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Pulsing User Location */
        .user-pulse {
            width: 14px; height: 14px;
            background: #fff; border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }
    </style>
</head>
<body>

    <div class="radar-scan"></div>

    <div class="glass-panel">
        <h1>RADAR SYSTEM V3.0</h1>
        <div class="stat-row">
            <span class="label">SYSTEM:</span>
            <span class="value" id="status">INITIALIZING...</span>
        </div>
        <div class="stat-row">
            <span class="label">AIRCRAFT:</span>
            <span class="value" id="count">0</span>
        </div>
        <div class="stat-row">
            <span class="label">COORDS:</span>
            <span class="value" id="loc">SEARCHING...</span>
        </div>

        <div class="dev-info">
            SYSTEM ARCHITECT:<br>
            <span class="dev-name">Csm Mohasin Alam</span>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        let map, planeLayer;
        const NEON_BLUE = "#00f3ff";

        async function initRadar(lat, lon) {
            try {
                // ম্যাপ লোড হচ্ছে কিনা নিশ্চিত করা
                map = L.map('map', { zoomControl: false, attributionControl: false }).setView([lat, lon], 10);
                document.getElementById('loc').innerText = `${lat.toFixed(2)}, ${lon.toFixed(2)}`;

                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

                const userIcon = L.divIcon({ className: 'user-pulse', iconSize: [14, 14] });
                L.marker([lat, lon], { icon: userIcon }).addTo(map).bindPopup("MY BASE STATION");

                planeLayer = L.layerGroup().addTo(map);
                updateRadar(lat, lon);
                setInterval(() => updateRadar(lat, lon), 15000); // ১৫ সেকেন্ড পর পর আপডেট
                
                document.getElementById('status').innerText = "ONLINE";
            } catch (err) {
                document.getElementById('status').innerText = "MAP ERROR";
                console.error(err);
            }
        }

        async function updateRadar(lat, lon) {
            const range = 1.8; // ২০০ কিমি এরিয়া
            const url = `https://opensky-network.org/api/states/all?lamin=${lat-range}&lamax=${lat+range}&lomin=${lon-range}&lomax=${lon+range}`;

            try {
                const res = await fetch(url);
                if (!res.ok) throw new Error("API Limit");
                const data = await res.json();
                const states = data.states || [];
                
                document.getElementById('count').innerText = states.length;
                renderPlanes(states);
            } catch (e) {
                document.getElementById('status').innerText = "DATA BUSY";
                console.log("API Limit Reached or Network Issue");
            }
        }

        function renderPlanes(states) {
            planeLayer.clearLayers();
            states.forEach(s => {
                const [icao, callsign, origin, , , lon, lat, alt, , vel, track] = s;
                
                if (lat && lon) {
                    const planeMarkup = `
                        <div style="transform: rotate(${(track || 0) - 45}deg);">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="${NEON_BLUE}">
                                <path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/>
                            </svg>
                        </div>`;

                    const marker = L.marker([lat, lon], {
                        icon: L.divIcon({ html: planeMarkup, className: '', iconSize: [24, 24] })
                    });

                    marker.bindPopup(`
                        <div style="color:#000; font-family:monospace; font-size:12px;">
                            <b>ID: ${callsign || 'N/A'}</b><br>
                            ORIGIN: ${origin}<br>
                            ALT: ${Math.round(alt || 0)}m<br>
                            SPEED: ${Math.round((vel || 0) * 3.6)}km/h
                        </div>
                    `);
                    planeLayer.addLayer(marker);
                }
            });
        }

        window.onload = () => {
            // ইউজারের কাছ থেকে লোকেশন পাওয়ার ট্রাই
            navigator.geolocation.getCurrentPosition(
                p => initRadar(p.coords.latitude, p.coords.longitude),
                () => {
                    console.log("Location Denied. Using Default.");
                    initRadar(23.81, 90.41); // ঢাকা ডিফল্ট
                },
                { timeout: 10000 }
            );
        };
    </script>
</body>
</html>
