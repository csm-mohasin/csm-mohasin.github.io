<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSM Smart Radar | Mohasin Alam</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <style>
        :root {
            --neon-blue: #00f3ff;
            --radar-bg: rgba(10, 20, 30, 0.8);
        }

        body, html { margin: 0; padding: 0; height: 100%; background: #050505; color: var(--neon-blue); font-family: 'Share Tech Mono', monospace; }
        
        #map { height: 100vh; width: 100%; z-index: 1; filter: hue-rotate(10deg) brightness(0.8); }

        /* Smart UI Panel */
        .glass-panel {
            position: absolute;
            top: 20px; left: 20px; z-index: 1000;
            background: var(--radar-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 243, 255, 0.3);
            padding: 20px; border-radius: 4px;
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.1);
            width: 280px;
        }

        h1 { font-family: 'Syncopate', sans-serif; font-size: 14px; margin: 0 0 15px 0; letter-spacing: 3px; color: #fff; border-left: 3px solid var(--neon-blue); padding-left: 10px; }

        .stat-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 12px; }
        .label { color: rgba(255,255,255,0.6); }
        .value { color: var(--neon-blue); text-shadow: 0 0 5px var(--neon-blue); }

        .dev-info { margin-top: 20px; font-size: 10px; border-top: 1px dashed rgba(255,255,255,0.2); padding-top: 10px; text-align: center; }
        .dev-name { color: #facc15; font-weight: bold; text-transform: uppercase; }

        /* Pulsing User Location */
        .user-pulse {
            width: 12px; height: 12px;
            background: #fff; border-radius: 50%;
            box-shadow: 0 0 0 rgba(255, 255, 255, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }

        /* Plane Icons */
        .plane-wrapper { transition: all 1s linear; }
    </style>
</head>
<body>

    <div class="glass-panel">
        <h1>RADAR SYSTEM v2.0</h1>
        <div class="stat-row">
            <span class="label">STATUS:</span>
            <span class="value" id="status">SCANNING...</span>
        </div>
        <div class="stat-row">
            <span class="label">AIRCRAFT DETECTED:</span>
            <span class="value" id="count">0</span>
        </div>
        <div class="stat-row">
            <span class="label">LOCATION:</span>
            <span class="value" id="loc">FETCHING...</span>
        </div>

        <div class="dev-info">
            SYSTEM ARCHITECT:<br>
            <span class="dev-name">Csm Mohasin Alam</span>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        let map, planeLayer;
        let activePlanes = {};

        async function initRadar(lat, lon) {
            map = L.map('map', { zoomControl: false }).setView([lat, lon], 10);
            document.getElementById('loc').innerText = `${lat.toFixed(2)}, ${lon.toFixed(2)}`;

            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

            // User Pulse Marker
            const userIcon = L.divIcon({ className: 'user-pulse', iconSize: [12, 12] });
            L.marker([lat, lon], { icon: userIcon }).addTo(map).bindPopup("COMMUNICATION HUB");

            planeLayer = L.layerGroup().addTo(map);
            updateRadar(lat, lon);
            setInterval(() => updateRadar(lat, lon), 12000);
        }

        async function updateRadar(lat, lon) {
            document.getElementById('status').innerText = "UPDATING...";
            const range = 1.5;
            const url = `https://opensky-network.org/api/states/all?lamin=${lat-range}&lamax=${lat+range}&lomin=${lon-range}&lomax=${lon+range}`;

            try {
                const res = await fetch(url);
                const data = await res.json();
                const states = data.states || [];
                
                document.getElementById('count').innerText = states.length;
                renderPlanes(states);
                document.getElementById('status').innerText = "ACTIVE";
            } catch (e) {
                document.getElementById('status').innerText = "OFFLINE";
            }
        }

        function renderPlanes(states) {
            planeLayer.clearLayers();
            states.forEach(s => {
                const [icao, callsign, origin, time, , lon, lat, alt, , vel, track] = s;
                
                if (lat && lon) {
                    const planeMarkup = `
                        <div style="transform: rotate(${track || 0}deg);">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="${var(--neon-blue)}">
                                <path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/>
                            </svg>
                        </div>`;

                    const marker = L.marker([lat, lon], {
                        icon: L.divIcon({ html: planeMarkup, className: 'plane-wrapper', iconSize: [24, 24] })
                    });

                    marker.bindPopup(`
                        <div style="color:#000; font-family:monospace">
                            <b>FLIGHT: ${callsign || 'UNKNOWN'}</b><br>
                            ORIGIN: ${origin}<br>
                            ALT: ${Math.round(alt)}m<br>
                            SPD: ${Math.round(vel * 3.6)}km/h
                        </div>
                    `);
                    planeLayer.addLayer(marker);
                }
            });
        }

        window.onload = () => {
            navigator.geolocation.getCurrentPosition(
                p => initRadar(p.coords.latitude, p.coords.longitude),
                () => initRadar(23.81, 90.41)
            );
        };
    </script>
</body>
</html>
