<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Delivery Dashboard ‚Äî Live Tracking</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body {
    font-family: Arial, sans-serif;
    background: #e9eef5;
  }
  #map {
    height: 400px;
    width: 100%;
    border-radius: 10px;
  }
  .container {
    width: 95%;
    margin: auto;
    margin-top: 15px;
  }
  .card {
    background: #fff;
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>

<div class="container">
  <h3>üöö Delivery Dashboard ‚Äî Live Tracking</h3>

  <div id="map"></div>

  <div id="tracking-log"></div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
// ---------------- Map Setup ----------------

// Default Map Layer (OpenStreetMap)
var defaultLayer = L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 19
});

// Google Satellite Layer
var googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
  maxZoom: 20,
  subdomains: ['mt0','mt1','mt2','mt3']
});

// Map Initialize
var map = L.map("map", {
  center: [23.8103, 90.4125], // Dhaka default
  zoom: 10,
  layers: [defaultLayer] // default view
});

// Layer Control (Map Switch Button)
var baseMaps = {
  "Default Map": defaultLayer,
  "Satellite View": googleSat
};
L.control.layers(baseMaps).addTo(map);

// Marker
var marker = L.marker([23.8103, 90.4125]).addTo(map);

// ---------------- Real-time Firebase Fetch ----------------

// Replace with your Realtime Database URL
var firebaseURL = "https://your-database.firebaseio.com/location.json";

async function getLocationData() {
  try {
    let res = await fetch(firebaseURL);
    let data = await res.json();

    if (!data) return;

    let lat = data.lat;
    let lng = data.lng;
    let bat = data.battery;
    let device = data.device;
    let charging = data.charging;
    let time = new Date().toString();

    // Update marker position
    marker.setLatLng([lat, lng]);
    map.setView([lat, lng], 14);

    // Marker Popup
    marker.bindPopup(`${device}, Battery: ${bat}%`).openPopup();

    // Show log
    addLog(lat, lng, bat, device, time);

  } catch (e) {
    console.log("Error fetching data", e);
  }
}

// Tracking log UI
function addLog(lat, lng, bat, device, time) {
  let box = document.getElementById("tracking-log");
  box.innerHTML = `
    <div class='card'>
      <b>${device}</b> | üîã ${bat}% <br>
      üìç ${lat}, ${lng} <br>
      üïí ${time}
    </div>
  ` + box.innerHTML;
}

// Auto refresh every 5 sec
setInterval(getLocationData, 5000);
</script>

</body>
</html>
